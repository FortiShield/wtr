#compdef branchops

_branchops() {
  local curcontext="$curcontext" state line
  typeset -A opt_args

  local -a commands=(
    'create:Create a new worktree'
    'new:Create a new worktree (alias for create)'
    'remove:Remove a worktree'
    'rm:Remove a worktree (alias for remove)'
    'go:Navigate to a worktree path'
    'run:Run a command in a worktree'
    'editor:Open a worktree in editor'
    'ai:Start AI tool in a worktree'
    'copy:Copy files between worktrees'
    'ls:List all worktrees'
    'list:List all worktrees (alias for ls)'
    'dashboard:Show worktree dashboard'
    'status:Show worktree status (alias for dashboard)'
    'ui:Open worktree UI'
    'hooks:Manage or run hooks'
    'sync:Sync worktree with main repo'
    'exec:Execute command in all worktrees'
    'backup:Backup worktree configuration'
    'restore:Restore worktree configuration'
    'clean:Clean up broken worktrees'
    'doctor:Check for common issues'
    'adapter:Manage adapters'
    'config:Manage configuration'
    'completions:Generate shell completions'
    'help:Show help'
    'version:Show version'
  )

  local -a create_flags=(
    '--from[Base reference]:branch:__git_branch_names'
    '--from-current[Create from current branch]'
    '--track[Tracking mode]:mode:(auto true false)'
    '--no-copy[Skip copying files]'
    '--no-fetch[Skip fetching from remote]'
    '--yes[Non-interactive mode]'
    '--force[Force creation]'
    '--name[Custom worktree name]:name'
    '--editor[Open in editor]:editor:(vscode vscode_remote nvim vim emacs cursor zed idea webstorm pycharm atom sublime nano)'
    '--ai[Start AI tool]:ai_tool:(aider claude continue codex copilot gemini cursor opencode)'
    '--preset[Apply preset]:preset'
  )

  local -a common_flags=(
    '--yes[Non-interactive mode]'
    '--force[Force operation]'
  )

  _arguments -C \
    "1: :->cmnds" \
    "*::arg:->args"

  case "$state" in
    cmnds)
      _describe 'command' commands
      ;;
    args)
      case $line[1] in
        create|new)
          _arguments $create_flags
          ;;
        remove|rm|go|run|editor|ai|hooks|sync|backup|restore)
          local -a branches
          branches=($(git branch --format='%(refname:short)' 2>/dev/null))
          _describe 'branch' branches
          ;;
        completions)
          local -a shells=(bash zsh fish)
          _describe 'shell' shells
          ;;
        config)
          local -a config_cmds=(get set list unset)
          _describe 'config command' config_cmds
          ;;
      esac
      ;;
  esac
}

__git_branch_names() {
  local -a branches
  branches=($(git branch --format='%(refname:short)' 2>/dev/null))
  _describe 'branch' branches
}

_branchops "$@"
